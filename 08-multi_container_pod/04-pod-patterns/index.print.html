<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.121.1"><meta name=generator content="Relearn 5.23.2+tip"><meta name=robots content="noindex, nofollow, noarchive, noimageindex"><meta name=description content="Kubernetes pocket gude and more"><meta name=author content="Ansil H"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kubernetes.ansilh.com/images/hero.png"><meta name=twitter:title content="Pod design patterns :: Hugo Relearn Theme"><meta name=twitter:description content="Kubernetes pocket gude and more"><meta property="og:title" content="Pod design patterns :: Hugo Relearn Theme"><meta property="og:description" content="Kubernetes pocket gude and more"><meta property="og:type" content="website"><meta property="og:url" content="https://kubernetes.ansilh.com/08-multi_container_pod/04-pod-patterns/index.html"><meta property="og:image" content="https://kubernetes.ansilh.com/images/hero.png"><meta property="og:site_name" content="Hugo Relearn Theme"><title>Pod design patterns :: Hugo Relearn Theme</title>
<link href=../../images/logo.svg?1704651914 rel=icon type=image/svg+xml><link href=../../css/fontawesome-all.min.css?1704651918 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fontawesome-all.min.css?1704651918 rel=stylesheet></noscript><link href=../../css/nucleus.css?1704651918 rel=stylesheet><link href=../../css/auto-complete.css?1704651918 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/auto-complete.css?1704651918 rel=stylesheet></noscript><link href=../../css/perfect-scrollbar.min.css?1704651918 rel=stylesheet><link href=../../css/fonts.css?1704651918 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fonts.css?1704651918 rel=stylesheet></noscript><link href=../../css/theme.css?1704651918 rel=stylesheet><link href=../../css/theme-neon.css?1704651918 rel=stylesheet id=R-variant-style><link href=../../css/chroma-neon.css?1704651918 rel=stylesheet id=R-variant-chroma-style><link href=../../css/variant.css?1704651918 rel=stylesheet><link href=../../css/print.css?1704651918 rel=stylesheet media=print><link href=../../css/format-print.css?1704651918 rel=stylesheet><link href=../../css/ie.css?1704651918 rel=stylesheet><script src=../../js/url.js?1704651918></script><script src=../../js/variant.js?1704651918></script><script>window.index_js_url="../../index.search.js";var root_url="../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://kubernetes.ansilh.com/",window.relearn.themeVariantModifier="",window.variants&&variants.init(["neon"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><style>#R-body img.bg-white{background-color:#fff}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../08-multi_container_pod/04-pod-patterns/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../08-multi_container_pod/index.html><span itemprop=name>Multi-Container Pods</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Pod design patterns</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=pod-design-patterns>Pod design patterns</h1><p>When the containers have the exact same lifecycle, or when the containers must run on the same node. The most common scenario is that you have a helper process that needs to be located and managed on the same node as the primary container.</p><p>Another reason to combine containers into a single pod is for simpler communication between containers in the pod. These containers can communicate through shared volumes (writing to a shared file or directory) and through inter-process communication (semaphores or shared memory).</p><p>There are three common design patterns and use-cases for combining multiple containers into a single pod. We’ll walk through the <code>sidecar</code> pattern, the <code>adapter</code> pattern, and the <code>ambassador</code> pattern.</p><h3 id=example-1-sidecar-containers>Example #1: Sidecar containers</h3><p>Sidecar containers extend and enhance the “main” container, they take existing containers and make them better. As an example, consider a container that runs the Nginx web server. Add a different container that syncs the file system with a git repository, share the file system between the containers and you have built Git push-to-deploy.</p><p><a href=#R-image-f8c9e0e5ff603de17354d97cf7af8f35 class=lightbox-link><img src="../../08-multi_container_pod/04-pod-patterns/sidecar.png?classes=shadow" alt="Pod Design" class="figure-image bg-white border lightbox shadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f8c9e0e5ff603de17354d97cf7af8f35><img src="../../08-multi_container_pod/04-pod-patterns/sidecar.png?classes=shadow" alt="Pod Design" class="lightbox-image bg-white border lightbox shadow" loading=lazy></a></p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>demo-web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>demo-web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>demo-web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/usr/share/nginx/html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ansilh/debug-tools</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>git-pull</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s1>&#39;while true ; do [ ! -d /html/.git ] &amp;&amp; git  clone https://github.com/ansilh/k8s-demo-web.git /html/ || { cd /html; git pull; } ; date; sleep 5 ; done&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/html/</span></span></span></code></pre></div><p>Lets do a tail on the <code>logs</code> and see how the <code>git-pull</code> works</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl logs demo-web git-pull -f
</span></span><span class=line><span class=cl>Cloning into <span class=s1>&#39;/html&#39;</span>...
</span></span><span class=line><span class=cl>Fri Jan <span class=m>11</span> 20:39:25 UTC <span class=m>2019</span>
</span></span><span class=line><span class=cl>Already up to date.
</span></span><span class=line><span class=cl>Fri Jan <span class=m>11</span> 20:39:31 UTC <span class=m>2019</span></span></span></code></pre></div><p>Lets modify the WebPage and push the changes to Github</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Already up to date.
</span></span></span><span class=line><span class=cl><span class=go>Fri Jan 11 20:44:04 UTC 2019
</span></span></span><span class=line><span class=cl><span class=go>From https://github.com/ansilh/k8s-demo-web
</span></span></span><span class=line><span class=cl><span class=go>   e2df24f..1791ee1  master     -&gt; origin/master
</span></span></span><span class=line><span class=cl><span class=go>Updating e2df24f..1791ee1
</span></span></span><span class=line><span class=cl><span class=go>Fast-forward
</span></span></span><span class=line><span class=cl><span class=go> images/pic-k8s.jpg | Bin 0 -&gt; 14645 bytes
</span></span></span><span class=line><span class=cl><span class=go> index.html         |   4 ++--
</span></span></span><span class=line><span class=cl><span class=go> 2 files changed, 2 insertions(+), 2 deletions(-)
</span></span></span><span class=line><span class=cl><span class=go> create mode 100644 images/pic-k8s.jpg
</span></span></span><span class=line><span class=cl><span class=go>Fri Jan 11 20:44:10 UTC 2019
</span></span></span><span class=line><span class=cl><span class=go>Already up to date.
</span></span></span></code></pre></div><h3 id=example-2-ambassador-containers>Example #2: Ambassador containers</h3><p>Ambassador containers proxy a local connection to the world. As an example, consider a Redis cluster with read-replicas and a single write master. You can create a Pod that groups your main application with a Redis ambassador container. The ambassador is a proxy is responsible for splitting reads and writes and sending them on to the appropriate servers. Because these two containers share a network namespace, they share an IP address and your application can open a connection on “localhost” and find the proxy without any service discovery. As far as your main application is concerned, it is simply connecting to a Redis server on localhost. This is powerful, not just because of separation of concerns and the fact that different teams can easily own the components, but also because in the development environment, you can simply skip the proxy and connect directly to a Redis server that is running on localhost.</p><p><a href=#R-image-f6d3a6b666c555ceb8eeb998ce2f1485 class=lightbox-link><img src="../../08-multi_container_pod/04-pod-patterns/ambassador.png?classes=shadow" alt="Pod Design" class="figure-image bg-white border lightbox shadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f6d3a6b666c555ceb8eeb998ce2f1485><img src="../../08-multi_container_pod/04-pod-patterns/ambassador.png?classes=shadow" alt="Pod Design" class="lightbox-image bg-white border lightbox shadow" loading=lazy></a></p><h3 id=example-3-adapter-containers>Example #3: Adapter containers</h3><p>Adapter containers standardize and normalize output. Consider the task of monitoring N different applications. Each application may be built with a different way of exporting monitoring data. (e.g. JMX, StatsD, application specific statistics) but every monitoring system expects a consistent and uniform data model for the monitoring data it collects. By using the adapter pattern of composite containers, you can transform the heterogeneous monitoring data from different systems into a single unified representation by creating Pods that groups the application containers with adapters that know how to do the transformation. Again because these Pods share namespaces and file systems, the coordination of these two containers is simple and straightforward.</p><p><a href=#R-image-e7e51514cf40bd8c258e8d51b6bce48f class=lightbox-link><img src="../../08-multi_container_pod/04-pod-patterns/adapter.png?classes=shadow" alt="Pod Design" class="figure-image bg-white border lightbox shadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e7e51514cf40bd8c258e8d51b6bce48f><img src="../../08-multi_container_pod/04-pod-patterns/adapter.png?classes=shadow" alt="Pod Design" class="lightbox-image bg-white border lightbox shadow" loading=lazy></a></p><footer class=footline></footer></article><script src=https://giscus.app/client.js data-repo=ansilh/kubernetes.github.io data-repo-id=R_kgDOLB2cOA data-category=Announcements data-category-id=DIC_kwDOLB2cOM4CcQpH data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div></main></div><script src=../../js/clipboard.min.js?1704651918 defer></script><script src=../../js/perfect-scrollbar.min.js?1704651918 defer></script><script src=../../js/theme.js?1704651918 defer></script></body></html>